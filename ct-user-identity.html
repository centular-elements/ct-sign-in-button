<script>
    window.CT = window.CT || {};
    CT.identity = CT.identity || {
                domainId: null,
                clientId: null,
                userId: null,
                token: null
            };
    window.CT.Behaviours = window.CT.Behaviours || {};
    CT.Behaviours.Identity = {
        _signIn: function() {
            CT.currentPage = window.location;
            window.location = [
                CT.context.authHostUrl, '/oauth/authorise?response_type=token&client_id=', CT.context.clientId,
                '&redirect_uri=', encodeURIComponent(CT.context.tokenRedirectUri), '&state=0'
            ].join('');
        },

        _setIdentity: function(jwtToken) {
            if (jwtToken) {
                var jwtClaimSetEncoded = jwtToken.split(".")[1];
                var jwtClaimSet = JSON.parse(atob(jwtClaimSetEncoded));
                CT.identity = {
                    domainId: jwtClaimSet.did,
                    clientId: jwtClaimSet.cid,
                    userId: jwtClaimSet.uid,
                    token: jwtToken
                }
            } else {
                CT.identity = {
                    domainId: null,
                    clientId: null,
                    userId: null,
                    token: null
                };
            }
        },

        _signOut: function() {
            this._setIdentity(null);
            window.location = [CT.context.authHostUrl, '/sign-out', '?next=', encodeURIComponent(this.afterSignOutUrl)].join('');
        }
    }
</script>